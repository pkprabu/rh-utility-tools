<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>End-to-End Process Document: Definitive Email Auditor</title>
    <style>
        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            max-width: 1024px; 
            margin: 20px auto; 
            padding: 0 20px;
            background-color: #fdfdfd;
        }
        h1, h2, h3, h4 { 
            color: #c00; /* Red Hat Red */
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
            margin-top: 2em;
        }
        h1 {
            font-size: 2.5em;
            border-bottom-width: 4px;
        }
        code { 
            background-color: #f4f4f4; 
            padding: 2px 6px; 
            border: 1px solid #ddd;
            border-radius: 4px; 
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        pre { 
            background-color: #282c34; /* Dark theme for code blocks */
            color: #abb2bf;
            padding: 20px; 
            border-radius: 8px; 
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        .section, .feature-category {
            background-color: #fff;
            border: 1px solid #ddd;
            padding: 25px;
            margin-bottom: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        .filename {
            font-weight: bold;
            color: #0056b3;
        }
        .feature {
            border-left: 4px solid #c00;
            padding-left: 15px;
            margin-bottom: 1.5em;
        }
        .refactorable {
            display: inline-block;
            background-color: #e6f4ea;
            color: #006421;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-left: 10px;
        }
        ul {
            padding-left: 20px;
        }
        li {
            margin-bottom: 0.5em;
        }
        strong {
            color: #333;
        }
    </style>
</head>
<body>

    <h1>Definitive Email Auditor: Process Document</h1>

    <div class="section">
        <h2>1.0 Introduction</h2>
        <p>This document outlines the complete operational workflow of the <strong>Definitive Email Auditor</strong>, a client-side web application designed to validate and refactor email HTML code. The tool ensures that emails adhere to a predefined set of rules, including brand guidelines, accessibility standards, and technical best practices, before deployment.</p>
    </div>

    <div class="section">
        <h2>2.0 System Architecture</h2>
        <p>The application is a <strong>modular, single-page application (SPA)</strong> that runs entirely in the user's web browser. It leverages a sandboxed <code>&lt;iframe&gt;</code> to safely parse and analyze the provided HTML without affecting the main application page. The architecture is designed for maintainability and scalability by separating concerns into distinct JavaScript modules.</p>
    </div>
    
    <div class="section">
        <h2>3.0 End-to-End Workflow</h2>
        <p>The workflow details the data flow and process from initial user interaction to the final output. The core stages are: User Input, Debounced Audit Trigger, Two-Phase Audit Execution, Result Rendering, and Optional Code Refactoring.</p>
    </div>

    <div class="section">
        <h2>4.0 Feature Deep Dive</h2>
        <p>The auditor includes numerous distinct checks, which can be grouped into several categories. Each feature is designed to enforce a specific rule critical for marketing operations, brand consistency, or technical correctness.</p>

        <div class="feature-category">
            <h3>4.1 URL & Link Validation</h3>
            
            <div class="feature">
                <h4>Universal `sc_cid` Tracking Validation <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> This is a multi-part check that validates the presence and correctness of the <code>sc_cid</code> tracking parameter on all applicable links. The refactorer will automatically add the correct `sc_cid` to links that are missing the parameter or have an empty one.</p>
                <ul>
                    <li><strong>Audit:</strong> Detects links that are missing the parameter, have the wrong value, are malformed, empty, or duplicated.</li>
                    <li><strong>Refactor:</strong> If a link is missing the `sc_cid` parameter (or it is present but empty), the refactorer will append the correct parameter and value based on the user's input. It respects an internal ignore-list for links that should not be tracked.</li>
                </ul>
                <p><strong>Why it's important:</strong> Ensures accurate campaign tracking, which is fundamental for measuring marketing effectiveness.</p>
            </div>

            <div class="feature">
                <h4>Insecure Links (http://) <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> Scans all <code>href</code> attributes and flags any URL that uses the insecure <code>http://</code> protocol.</p>
                <p><strong>Why it's important:</strong> Protects user security and privacy. Modern browsers often show warnings for insecure content, which can erode user trust.</p>
            </div>

            <div class="feature">
                <h4>Links without `target="_blank"` <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> Checks if links (excluding certain types like `mailto:` or same-page anchors) are missing the <code>target="_blank"</code> attribute.</p>
                <p><strong>Why it's important:</strong> Ensures that when a user clicks a link in an email, it opens in a new browser tab, preventing them from navigating away from their webmail client.</p>
            </div>

             <div class="feature">
                <h4>Underlined Linked Images <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> Finds `&lt;a&gt;` tags that contain an `&lt;img&gt;` and ensures they have the `text-decoration: none;` style applied.</p>
                <p><strong>Why it's important:</strong> Prevents some email clients from rendering a distracting and unsightly underline on clickable images.</p>
            </div>
        </div>

        <div class="feature-category">
            <h3>4.2 Branding & Content Compliance</h3>

            <div class="feature">
                <h4>Trademark & Symbol Validation <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> A robust, multi-phase check to enforce correct trademark (®) usage. This combines several checks into one category.</p>
                 <ul>
                    <li>Detects raw `®` symbols that are not wrapped in a `&lt;sup&gt;` tag.</li>
                    <li>Flags `&lt;sup&gt;` tags containing the symbol that are missing the required `style="line-height: 0;"`.</li>
                    <li>Identifies and collapses consecutive or improperly nested trademark `&lt;sup&gt;` tags.</li>
                </ul>
                <p><strong>Why it's important:</strong> Ensures legal compliance and consistent brand representation across all communications.</p>
            </div>

            <div class="feature">
                <h4>"Red Hat" Spacing <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> Uses a regular expression to find instances of "Red Hat" that use a standard space instead of the required non-breaking space (`&amp;nbsp;`).</p>
                <p><strong>Why it's important:</strong> Prevents the brand name from being awkwardly split across two lines, maintaining visual integrity.</p>
            </div>

            <div class="feature">
                <h4>Invalid Font Family</h4>
                <p><strong>What it does:</strong> Checks the computed `font-family` of text elements against an approved list of brand fonts.</p>
                <p><strong>Why it's important:</strong> Maintains brand consistency and ensures typography renders as designed.</p>
            </div>

            <div class="feature">
                <h4>Placeholder (Dummy) Text</h4>
                <p><strong>What it does:</strong> Scans all text content for common placeholder words like "lorem," "ipsum," etc.</p>
                <p><strong>Why it's important:</strong> A final safety check to prevent emails from being sent with incomplete content.</p>
            </div>
        </div>

        <div class="feature-category">
            <h3>4.3 HTML Best Practices & Accessibility</h3>

            <div class="feature">
                <h4>Image & Link Compliance <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> A group of checks for `&lt;img&gt;` tags and the `&lt;a&gt;` tags that contain them. The refactorer applies intelligent fixes.</p>
                <ul>
                    <li><strong>Invalid Source:</strong> Ensures the `src` attribute points to the approved image host.</li>
                    <li><strong>Missing Alt Text:</strong> Checks for and fixes missing `alt` attributes by adding `alt=""`.</li>
                    <li><strong>Missing/Incorrect Dimensions:</strong> Verifies that `width` and `height` attributes are present. The refactorer sets these attributes based on the image's actual dimensions to prevent layout shift, while also adding `style="height: auto;"` to ensure responsiveness.</li>
                    <li><strong>Missing Border:</strong> Ensures `border="0"` is set on the attribute and in the style.</li>
                    <li><strong>Missing `display: block`:** Adds this style to remove extra spacing below images in some clients.</li>
                    <li><strong>Responsive Styling:</strong> For large images, the refactorer automatically applies the "fluid-hybrid" technique (`width:100%`, `max-width: [original]px`) to ensure they scale correctly on mobile devices.</li>
                </ul>
                <p><strong>Why it's important:</strong> This suite of fixes ensures images are accessible, correctly sized, responsive, and free of common rendering bugs like unwanted borders or gaps.</p>
            </div>

            <div class="feature">
                <h4>Table Layout & Accessibility <span class="refactorable">Auto-Fixable</span></h4>
                <p><strong>What it does:</strong> Checks all `&lt;table&gt;` elements to ensure they have `role="presentation"` and `border="0"`.</p>
                <p><strong>Why it's important:</strong> Tells screen readers to treat layout tables as visual wrappers, not data tables, which is crucial for accessibility.</p>
            </div>

            <div class="feature">
                <h4>Inaccessible 'Empty' Links</h4>
                <p><strong>What it does:</strong> Finds `&lt;a&gt;` tags that contain no text and no image with alt text, making them "invisible" to screen readers.</p>
                <p><strong>Why it's important:</strong> Links without any descriptive text are a major accessibility issue.</p>
            </div>
        </div>
    </div>

</body>
</html>
